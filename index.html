<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPIC•EPIC•EPIC•EPIC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <style>
        @font-face {
            font-family: 'FaceYourFears';
            src: url('data:font/woff;base64,PASTE BASE64 CODE HERE') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: 'FaceYourFears', sans-serif;
        }
        main {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
section {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    width: 100%;
    height: 100vh;
    padding: 0; /* Ensure no padding is disrupting the centering */
    box-sizing: border-box;
    position: relative;
}
        section::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }
        .page1 {
            background-image: url('https://raw.githubusercontent.com/snoop-frog/cipe/main/top1.webp');
        }
        .page2 {
            background-image: url('https://raw.githubusercontent.com/snoop-frog/cipe/main/middle3.webp');
        }
        .page3 {
            background-image: url('https://raw.githubusercontent.com/snoop-frog/cipe/main/bottom3.webp');
        }
        .logo {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: auto;
            z-index: 10;
        }
        .media-links {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        h1, h2, p, button, a {
            color: #FFF;
            z-index: 2;
            position: relative;
        }
        h1 {
            font-size: 2.5rem;
            margin: 10px;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }
        h2 {
            font-size: 2rem;
            margin: 10px;
        }
        p, a {
            font-size: 1rem;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.4);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 20px;
        }
        a {
            text-decoration: none;
            font-weight: bold;
        }
        a:hover {
            text-decoration: underline;
            color: #800080;
        }
        .blob-button {
            font-family: 'FaceYourFears', sans-serif;
            font-size: 1rem;
            padding: 12px 24px;
            color: #FFF;
            background: linear-gradient(135deg, #800080 40%, #9921e8 100%);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 16px 0 rgba(152, 33, 232, 0.4);
            text-decoration: none;
        }
        .blob-button:hover {
            transform: scale(1.1);
        }
#uploadCrown {
    filter: brightness(0) invert(1);
}

#uploadCrown:hover {
    filter: none;
}


        #crownContainer {
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px; /* Added margin to move it down */
        }
        #canvasContainer, #crownContainer, #thumbnailContainer, #searchQuery {
            display: none; /* Initially hide these elements */
        }
        .crown-instructions {
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        #canvasContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }
        canvas {
            touch-action: none;
        }
        .crown {
            width: 100px;
            cursor: pointer;
            display: inline-block;
            margin: 5px;
            z-index: 5;
        }
        .thumbnail-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            width: 100%;
            max-width: 800px;
            margin: auto;
            padding: 10px;
        }
        .thumbnail-container img {
            width: 100%;
            height: auto;
            cursor: pointer;
        }
        .centered {
            display: block;
            margin: 20px auto;
            text-align: center;
        }
        .text-input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .text-input {
            padding: 10px;
            border: 2px solid #800080;
            border-radius: 5px;
            font-size: 1rem;
        }
        @media (max-width: 768px) {
            .logo {
                width: 80px;
            }
            h1 {
                font-size: 4rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            p, a {
                font-size: 0.9rem;
                padding: 8px;
                margin: 8px 16px;
            }
            button {
                padding: 8px 16px;
                font-size: 0.9rem;
                margin: 8px 16px;
            }
        }
        @keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.4);
    }
}

.pulse {
    animation: pulse 2s infinite;
    transition: transform 0.3s ease-in-out;
}

@media (max-width: 480px) {
    .logo {
        width: 100px; /* Adjust this value to make the logo larger or smaller */
    }
    h1 {
        font-size: 2.3rem;
    }
    h2 {
        font-size: 1.2rem;
    }
    p, a {
        font-size: 0.8rem;
        padding: 6px;
        margin: 6px 12px;
    }
    button {
        padding: 6px 12px;
        font-size: 0.8rem;
        margin: 6px 12px;
    }
}

        @media (min-width: 768px) {
            body section h1 {
                font-size: 6rem; /* Larger size for better visibility */
            }
        }
    </style>
</head>
<body>
    <main>
        <section class="page1">
            <img src="https://raw.githubusercontent.com/snoop-frog/cipe/main/0D0B7ECA-DB64-4620-ADFF-D24FF6AE21DE.png" alt="EPIC Rune Logo" class="logo">
            <h1>EPIC•EPIC•EPIC•EPIC</h1>
            <p>THE ONLY RUNE THAT ETCHED WITH THE FIRST EPIC SAT SINCE ORDINALS AND RUNE PROTOCOL</p>
            <a href="https://bitcoinmagazine.com/markets/one-of-only-four-bitcoin-epic-sats-just-auctioned-off-for-over-2-1-million" class="auction-link" target="_blank">THE EPIC SAT WAS ACQUIRED FOR 33.3BTC IN AN AUCTION</a>
            <div class="button-container">
                <a href="https://magiceden.io/runes/EPIC%E2%80%A2EPIC%E2%80%A2EPIC%E2%80%A2EPIC" target="_blank" class="blob-button">Buy $EPIC</a>
            </div>
        </section>
        <section class="page2">
            <div class="image-tool-container" id="imageToolContainer" style="position: relative; z-index: 3;">
                <h1 id="pageTitle" style="margin-bottom: 20px;">Make Your PFP EPIC</h1>
                <div class="text-input-container" id="textInputContainer" style="display: none;">
                    <input type="text" id="searchQuery" placeholder="Search normie memes..." class="text-input">
                    <input type="text" id="memeTextInput" class="text-input" placeholder="Enter meme text...">
                    <button id="addTextButton" class="blob-button">Add Text</button>
                </div>
                <div id="newBlobButton" style="display: none;">
                    <p>SELECT YOUR CROWN, MOVE, RESIZE AND ROTATE. TO REMOVE, DRAG OFF CANVAS</p>
                </div>
                <div id="crownContainer">
                    <div class="crown-row">
                        <img src="https://raw.githubusercontent.com/snoop-frog/cipe/main/3721ACB6-755A-4E05-B754-D6DB4E2B1190.png" alt="Crown 1" class="crown" onclick="addCrown(this)">
                        <img src="https://raw.githubusercontent.com/snoop-frog/cipe/main/0D0B7ECA-DB64-4620-ADFF-D24FF6AE21DE.png" alt="Crown 2" class="crown" onclick="addCrown(this)">
                    </div>
                </div>
                <div class="upload-container" id="uploadContainer" style="margin-bottom: 50px; text-align: center;">
                    <label for="fileUpload">
<img id="uploadCrown" src="https://raw.githubusercontent.com/snoop-frog/cipe/main/crowntrans.png" alt="Upload Image" class="pulse" style="cursor: pointer; width: 300px; height: auto;">
                    </label>
                    <input type="file" id="fileUpload" accept="image/*" style="display: none;">
                </div>
                <div class="thumbnail-container" id="thumbnailContainer"></div>
                <div id="canvasContainer">
                    <canvas id="canvas"></canvas>
                </div>
                <div class="button-container" id="buttonContainer" style="margin-top: 20px; display: none;">
                    <button id="newUploadButton" class="blob-button">Upload Image</button>
                    <button id="downloadButton" class="blob-button">Download Image</button>
                </div>
            </div>
        </section>
        <section class="page3">
            <h1>$EPIC IS EPIC</h1>
            <div style="z-index: 10; position: relative; text-align: center;">
                <a href="https://x.com/4xepic" target="_blank" style="display: inline-block; vertical-align: middle; background: none; border: none; outline: none; text-decoration: none;">
                    <img src="https://raw.githubusercontent.com/snoop-frog/cipe/main/xpurple8.png" alt="X Logo" style="width: 50px;">
                </a>
                <img src="https://raw.githubusercontent.com/snoop-frog/cipe/main/discord%20doodle2.png" alt="Discord Logo" style="width: 50px; display: inline-block; vertical-align: middle;">
                <p style="margin-top: 20px;">Discord Coming Soon</p>
            </div>
        </section>
    </main>
    <script>
        var canvas;
        let lastTap = 0;

        function handleDoubleTap(event, callback) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            clearTimeout(this.lastTapTimeout);
            if (tapLength < 300 && tapLength > 0) {
                event.preventDefault();
                callback();
            }
            lastTap = currentTime;
        }

        document.getElementById('uploadCrown').addEventListener('click', function() {
            document.getElementById('fileUpload').click();
        });

document.getElementById('fileUpload').addEventListener('change', function(e) {
    console.log("File selected");
    // Check if the file input has files selected
    if (this.files && this.files.length > 0) {
        var reader = new FileReader(); // Create a new instance of FileReader

        // Define what happens when the file has been successfully read
        reader.onload = function(event) {
            console.log("File loading complete");

            // Create a new image object
            var imgObj = new Image();
            imgObj.onload = function() {
                console.log("Image object created and loaded");

                // Check if canvas has been initialized
                if (!canvas) {
                    canvas = new fabric.Canvas('canvas', {
                        selection: false
                    });
                }

                // Calculate maximum canvas dimensions based on the window size
                var maxCanvasWidth = window.innerWidth * (window.innerWidth > 768 ? 0.7 : 0.9);
                var maxCanvasHeight = window.innerHeight * (window.innerHeight > 768 ? 0.7 : 0.9);

                // Determine the scale factor to fit the image within the canvas
                var scaleFactor = Math.min(
                    maxCanvasWidth / imgObj.width,
                    maxCanvasHeight / imgObj.height
                );

                // Set canvas dimensions based on scaled image dimensions
                var canvasWidth = imgObj.width * scaleFactor;
                var canvasHeight = imgObj.height * scaleFactor;

                // Create a new fabric Image object with the loaded image
                var image = new fabric.Image(imgObj, {
                    selectable: false,
                    evented: false,
                });

                // Scale and set image position
                image.scale(scaleFactor).set({
                    left: (canvasWidth - image.getScaledWidth()) / 2,
                    top: (canvasHeight - image.getScaledHeight()) / 2
                });

                // Clear canvas, set its dimensions, and add the new image
                canvas.clear();
                canvas.setDimensions({
                    width: canvasWidth,
                    height: canvasHeight
                });
                canvas.add(image);
                canvas.centerObject(image);
                canvas.renderAll();

                // Show or adjust UI elements as necessary
                document.getElementById('canvasContainer').style.display = 'flex';
                document.getElementById('crownContainer').style.display = 'block';
                document.getElementById('searchQuery').style.display = 'block';
                document.getElementById('uploadCrown').style.display = 'none';
                document.getElementById('buttonContainer').style.display = 'flex';
                document.getElementById('pageTitle').style.display = 'none';
                document.getElementById('textInputContainer').style.display = 'flex';
            };
            imgObj.src = event.target.result; // Set the source of the image object to the file data
        };

        // Read the file as a Data URL (base64 string) 
        reader.readAsDataURL(this.files[0]);
    } else {
        console.log("No file selected");
    }
});


        document.getElementById('newUploadButton').addEventListener('click', function() {
            document.getElementById('fileUpload').click();
        });

        document.getElementById('downloadButton').addEventListener('click', function() {
            const dataUrl = canvas.toDataURL({
                format: 'png',
                quality: 0.8
            });
            var link = document.createElement('a');
            link.download = 'EPIC-PFP.png';
            link.href = dataUrl;
            link.click();
        });

        document.getElementById('addTextButton').addEventListener('click', function() {
            const text = document.getElementById('memeTextInput').value;
            if (text) {
                const memeText = new fabric.Text(text, {
                    left: 50,
                    top: 50,
                    fontFamily: 'Arial',
                    fill: '#FFFFFF',
                    fontSize: 24,
                    fontWeight: 'bold',
                    stroke: '#000000',
                    strokeWidth: 1,
                    selectable: true
                });
                canvas.add(memeText);
                document.getElementById('memeTextInput').value = ''; // Clear the input field
                canvas.setActiveObject(memeText);
                canvas.renderAll();
            }
        });

        async function searchMemes() {
            const query = document.getElementById('searchQuery').value;
            const thumbnailContainer = document.getElementById('thumbnailContainer');
            const canvasContainer = document.getElementById('canvasContainer');

            canvasContainer.style.display = 'none';

            if (query.length < 3) {
                thumbnailContainer.innerHTML = '';
                thumbnailContainer.style.display = 'none';
                canvasContainer.style.display = 'flex';
                return;
            }

            thumbnailContainer.style.display = 'grid';

            const url = `https://corsproxy.io/?https://imgflip.com/memesearch?q=${encodeURIComponent(query)}`;
            const response = await fetch(url);
            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');
            const memeElements = doc.querySelectorAll('.mt-boxes .mt-box .mt-img-wrap a img');

            thumbnailContainer.innerHTML = '';
            let count = 0;
            memeElements.forEach(meme => {
                if (count < 6) {
                    const imgElement = document.createElement('img');
                    imgElement.src = meme.src;
                    imgElement.onclick = () => setMainImage(meme.src);
                    thumbnailContainer.appendChild(imgElement);
                    count++;
                }
            });
        }

        function setMainImage(src) {
            var imgObj = new Image();
            imgObj.onload = function() {
                setupCanvas(imgObj);
                document.getElementById('thumbnailContainer').style.display = 'none';
                document.getElementById('canvasContainer').style.display = 'flex';
                document.getElementById('crownContainer').style.display = 'block';
                document.getElementById('uploadCrown').style.display = 'none';
                document.getElementById('buttonContainer').style.display = 'flex';
                document.getElementById('textInputContainer').style.display = 'flex';
            };
            imgObj.src = src;
        }

        function setupCanvas(imgObj) {
            if (!canvas) {
                canvas = new fabric.Canvas('canvas', {
                    selection: false
                });
            }
            var maxCanvasWidth = window.innerWidth * (window.innerWidth > 768 ? 0.7 : 0.9);
            var maxCanvasHeight = window.innerHeight * (window.innerHeight > 768 ? 0.7 : 0.9);
            var scaleFactor = Math.min(maxCanvasWidth / imgObj.width, maxCanvasHeight / imgObj.height);
            var canvasWidth = imgObj.width * scaleFactor;
            var canvasHeight = imgObj.height * scaleFactor;
            canvas.clear();
            var image = new fabric.Image(imgObj, {
                selectable: false,
                evented: false,
            });
            image.scale(scaleFactor).set({
                left: (canvasWidth - image.getScaledWidth()) / 2,
                top: (canvasHeight - image.getScaledHeight()) / 2
            });
            canvas.setDimensions({ width: canvasWidth, height: canvasHeight });
            canvas.add(image);
            canvas.centerObject(image);
            canvas.renderAll();
            document.getElementById('canvasContainer').style.display = 'flex';
        }

        function addCrown(element) {
            fabric.Image.fromURL(element.src, function(img) {
                var scale = 0.3 * (canvas.width / img.width);
                img.scale(scale).set({
                    left: canvas.width / 2 - (img.getScaledWidth() / 2),
                    top: canvas.height / 2 - (img.getScaledHeight() / 2),
                    hasControls: true,
                    hasBorders: true,
                    selectable: true
                });
                img.on('mousedown', function(event) {
                    handleDoubleTap(event, function() {
                        canvas.remove(img);
                        canvas.renderAll();
                    });
                });
                img.on('touchend', function(e) {
                    handleDoubleTap(e, function() {
                        canvas.remove(img);
                        canvas.renderAll();
                    });
                });
                canvas.add(img);
                canvas.setActiveObject(img);
                canvas.renderAll();
            }, { crossOrigin: 'anonymous' });
        }

        document.getElementById('searchQuery').addEventListener('input', searchMemes);
    </script>
</body>
</html>
